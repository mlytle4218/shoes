/*! Wed Oct 17 2018 12:52:12 */

var shoeRenderer,shoeCamera,shoeScene,shoeContainer,animation,connectingElement="product-canvas",cameraDistance=50,modelInitialPosition=new THREE.Vector3(0,-4,0),modelScale=.8;function loadModelOntoPage(e){window.addEventListener("resize",onWindowResize,!1),window.addEventListener("mousedown",onMouseDown,!1),window.addEventListener("mouseup",onMouseUp,!1),shoeContainer=document.getElementById(connectingElement),(shoeCamera=new THREE.PerspectiveCamera(45,shoeContainer.clientWidth/shoeContainer.clientHeight,1,100)).position.set(0,0,cameraDistance),shoeScene=new THREE.Scene;var n=new THREE.Color(16777215);shoeScene.background=n;var o=new THREE.AmbientLight(16777215,.8);shoeScene.add(o);var t=new THREE.PointLight(10066329,.05,100,1);t.position.set(0,0,-1).normalize(),shoeCamera.add(t);var a=new THREE.SpotLight(16777215);a.position.set(0,25,0),a.castShadow=!0,a.shadow.mapSize.width=512,a.shadow.mapSize.height=512,a.shadow.camera.near=.5,a.shadow.camera.far=500,a.shadow.camera=new THREE.OrthographicCamera(-75,75,75,-75,.5,1e3),shoeScene.add(a),shoeScene.add(shoeCamera);var i=new THREE.PlaneBufferGeometry(50,50,32,32),s=new THREE.ShadowMaterial({opacity:.2}),r=new THREE.Mesh(i,s);r.name="shadowPlane",r.receiveShadow=!0,r.rotation.x=-Math.PI/36*17,r.position.y=-7,shoeScene.add(r),createProgress(shoeScene);var c=new THREE.OrbitControls(shoeCamera,shoeContainer);c.target.set(0,5,0),c.maxDistance=cameraDistance,c.minDistance=10,c.update(),(shoeRenderer=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),shoeRenderer.setSize(shoeContainer.clientWidth,shoeContainer.clientHeight),shoeRenderer.gammaOutput=!1,shoeRenderer.gammaInput=!0,shoeRenderer.gammaOutput=!0,shoeRenderer.shadowMap.enabled=!0,shoeRenderer.shadowMap.type=THREE.PCFSoftShadowMap,shoeContainer.appendChild(shoeRenderer.domElement),animation=new AnimateModel;var h=[0,0],d=new THREE.GLTFLoader;d.load(e.fab,function(n){n.scene.children[0].material.roughness=.8,n.scene.traverse(function(e){e instanceof THREE.Mesh&&(e.castShadow=!0)}),d.load(e.shiny,function(e){e.scene,e.scene.children[0].material.roughness=.2,e.scene.traverse(function(e){e instanceof THREE.Mesh&&(e.castShadow=!0)}),n.scene.rotation.y=-Math.PI/2,n.scene.scale.set(modelScale,modelScale,modelScale),n.scene.add(e.scene),shoeScene.add(n.scene),n.scene.position.copy(modelInitialPosition),removeProgress(),animation.setModel(n.scene),animation.startRotate(),animation.startFloat()},function(e){var n=e.loaded/e.total,o=n-h[1];h[1]=n,updateProgress(o/2)},function(e){console.error(e)})},function(e){var n=e.loaded/e.total,o=n-h[0];h[0]=n,updateProgress(o/2)},function(e){console.error(e)}),animate()}function createProgress(e){var n=new THREE.BoxGeometry(33,3,3),o=new THREE.MeshBasicMaterial({color:16711680}),t=new THREE.Mesh(n,o);t.scale.x=1e-4,t.position.y=5,t.name="cubeFront";var a=new THREE.MeshBasicMaterial({color:13421772}),i=new THREE.Mesh(n,a);i.position.z=-1,i.position.y=5,i.name="cubeBack",e.add(i),e.add(t)}function updateProgress(n){shoeScene.children.forEach(function(e){"cubeFront"===e.name&&(e.scale.x+=n,e.position.x=-(1-e.scale.x)*(e.geometry.parameters.width/2))})}function removeProgress(){var n,o;shoeScene.children.forEach(function(e){"cubeFront"===e.name&&(n=e),"cubeBack"===e.name&&(o=e)}),shoeScene.remove(n),shoeScene.remove(o)}function onWindowResize(){shoeCamera.aspect=shoeContainer.clientWidth/shoeContainer.clientHeight,shoeCamera.updateProjectionMatrix(),shoeRenderer.setSize(shoeContainer.clientWidth,shoeContainer.clientHeight)}function onMouseDown(e){inContainer(e)&&(animation.isRotating()||shoeScene.children.forEach(function(e){"shadowPlane"===e.name&&(shoeScene.remove(e),animation.stopFloat())}))}function onMouseUp(e){}function inContainer(e){return!!(e.clientX>shoeContainer.offsetLeft&e.clientX<shoeContainer.offsetLeft+shoeContainer.clientWidth&&e.clientY>shoeContainer.offsetTop&e.clientY<shoeContainer.offsetTop+shoeContainer.clientHeight)}function animate(){animation.hasModel()&&animation.tick(),requestAnimationFrame(animate),shoeRenderer.render(shoeScene,shoeCamera)}function AnimateModel(){var n,e=!1,o=0,t=!1,a=0,i=1,s=-1;this.tick=function(){e?this.rotate():t&!e&&this.float()},this.hasModel=function(){return n},this.setModel=function(e){n=e},this.startRotate=function(){e=!0},this.rotate=function(){125<=o?e=!1:(o++,n.rotation.y+=.05)},this.isRotating=function(){return e},this.startFloat=function(){t=!0},this.stopFloat=function(){t=!1},this.float=function(){1<=a?(a=1,s=-s):a<=-1&&(a=-1,s=-s),0===this.calcFloat(a)&&(i=-i),console.log(n.position),console.log(i*this.calcFloat(a)+modelInitialPosition.y),n.position.y=i*this.calcFloat(a)-1+modelInitialPosition.y,a+=.015625*s},this.calcFloat=function(e){return 1-Math.pow(e,2)}}